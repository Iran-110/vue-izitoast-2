os: linux

language: node_js

node_js:
  - 12

addons:
  apt:
    packages:
      - libgconf-2-4

cache:
  npm: true
  directories:
    - ~/.cache

stages:
  - tests
  - build
  - name: deploy
    if: tag IS present

install:
  - npm ci

jobs:
  include:
    - stage: tests
      name: E2E Test
      script:
        - npm run ci

    - stage: build
      name: Build
      script:
        - npm run build

    - stage: deploy
      name: Deploy
      script: skip
      before_deploy:
        - npm run storybook:build
      deploy:
        - provider: pages
          local_dir: 'storybook-public'
          github_token: $GITHUB_TOKEN
          on:
            all_branches: true
            tag: true

notifications:
  email:
    on_success: never
    on_failure: change
